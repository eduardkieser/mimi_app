<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mimi.Today</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="/static/mimi.css">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
  <script src="/static/mimi.js"></script>
  <script>
    // Set theme before page renders to prevent flash
    document.documentElement.setAttribute('data-theme', localStorage.getItem('mimi-theme') || 'solid');
  </script>
</head>
<body x-data="taskApp()" @scroll.window="checkRefresh" @touchstart="onTouchStart($event)" @touchend="onTouchEnd($event)">
  <!-- Theme picker -->
  <div class="theme-picker">
    <div class="theme-option" data-theme="dark" :class="{ active: theme === 'dark' }" @click="setTheme('dark')" title="Dark"></div>
    <div class="theme-option" data-theme="solid" :class="{ active: theme === 'solid' }" @click="setTheme('solid')" title="Solid"></div>
    <div class="theme-option" data-theme="sunset" :class="{ active: theme === 'sunset' }" @click="setTheme('sunset')" title="Sunset"></div>
    <div class="theme-option" data-theme="ocean" :class="{ active: theme === 'ocean' }" @click="setTheme('ocean')" title="Ocean"></div>
    <div class="theme-option" data-theme="neon" :class="{ active: theme === 'neon' }" @click="setTheme('neon')" title="Neon"></div>
    <div class="theme-option" data-theme="paper" :class="{ active: theme === 'paper' }" @click="setTheme('paper')" title="Paper"></div>
  </div>
  
  <div class="container">
    <header class="header">
      <div class="date-nav">
        <button class="nav-btn" @click="prevDay()" title="Previous day">&larr;</button>
        <div class="date-label">
          <h1 x-text="displayDateFormatted"></h1>
          <div class="today-badge" x-show="isToday">Today</div>
        </div>
        <button class="nav-btn" @click="nextDay()" :disabled="isToday" title="Next day">&rarr;</button>
      </div>
    </header>

    <!-- Task list -->
    <div class="task-list" id="task-list">
      <template x-for="task in tasks" :key="task.id">
        <div 
          class="task-card"
          :class="{
            'recurring': task.repeat_info && (task.repeat_info.type === 'daily' || task.repeat_info.type === 'weekly'),
            'one-time': !task.repeat_info || task.repeat_info.type === 'none' || task.repeat_info.type === 'monthly',
            'completed': task.status === 'completed',
            'just-completed': task.justCompleted,
            'readonly': !isToday
          }"
          :style="`min-height: ${Math.max(60, task.expected_minutes * 1.5)}px`"
          @click="toggleTask(task)"
          x-data="{ showNotes: false }"
        >
          <div class="task-content">
            <div class="task-checkbox">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </div>
            <div class="task-info">
              <div class="task-title" x-text="task.title"></div>
            </div>
            <!-- Info button for tasks with description -->
            <button 
              class="info-btn"
              :class="{ active: showNotes }"
              x-show="task.description"
              @click.stop="showNotes = !showNotes"
              title="View notes"
            >ⓘ</button>
            <span 
              class="task-badge done"
              x-show="task.status === 'completed'"
            >Done!</span>
            <span 
              class="repeat-indicator"
              x-show="task.repeat_info && (task.repeat_info.type === 'daily' || task.repeat_info.type === 'weekly') && task.status !== 'completed'"
              title="Recurring task"
            >↻</span>
          </div>
          <!-- Description panel -->
          <div 
            class="task-description"
            x-show="showNotes && task.description"
            x-transition
            x-text="task.description"
            @click.stop
          ></div>
        </div>
      </template>

      <!-- Empty state -->
      <div class="empty-state" x-show="tasks.length === 0">
        <p x-text="isToday ? 'No tasks for today' : 'No tasks for this day'"></p>
      </div>
    </div>
    
    <!-- Swipe hint for mobile users -->
    <div class="swipe-hint" x-show="tasks.length > 0">
      Swipe left/right to change days
    </div>
  </div>
</body>
</html>
